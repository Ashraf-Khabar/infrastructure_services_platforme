pipeline {
    agent any
    
    stages {
        stage('V√©rification des outils disponibles') {
            steps {
                sh '''
                    echo "üîç V√©rification des outils disponibles..."
                    echo "curl: $(which curl || echo 'non disponible')"
                    echo "wget: $(which wget || echo 'non disponible')"
                    echo "python: $(which python || echo 'non disponible')"
                    echo "python3: $(which python3 || echo 'non disponible')"
                    echo "apt-get: $(which apt-get || echo 'non disponible')"
                '''
            }
        }
        
        stage('Installation de Python sans wget') {
            steps {
                script {
                    
                    sh '''
                        # M√©thode 1: Utiliser curl si disponible
                        if command -v curl >/dev/null 2>&1; then
                            echo "T√©l√©chargement avec curl..."
                            curl -o Python-3.9.18.tgz https://www.python.org/ftp/python/3.9.18/Python-3.9.18.tgz
                        
                        # M√©thode 2: V√©rifier si Python est d√©j√† disponible
                        elif command -v python3 >/dev/null 2>&1; then
                            echo "Python3 est d√©j√† disponible: $(python3 --version)"
                            exit 0
                            
                        # M√©thode 3: V√©rifier dans les emplacements communs
                        elif [ -f "/usr/bin/python3" ]; then
                            echo "Python3 trouv√© dans /usr/bin/python3"
                            ln -s /usr/bin/python3 /usr/local/bin/python
                            python3 --version
                            exit 0
                            
                        else
                            echo "Aucun outil de t√©l√©chargement disponible"
                            echo "Python pourrait √™tre d√©j√† install√© ailleurs..."
                            
                            # Chercher Python dans les emplacements communs
                            find /usr -name "python*" 2>/dev/null | head -5 || echo "Python non trouv√©"
                            exit 1
                        fi
                        
                        # Extraire et compiler si le t√©l√©chargement a r√©ussi
                        if [ -f "Python-3.9.18.tgz" ]; then
                            echo "Extraction de Python..."
                            tar -xzf Python-3.9.18.tgz
                            cd Python-3.9.18
                            
                            echo "Compilation..."
                            ./configure --prefix=$HOME/python --enable-optimizations
                            make
                            make install
                            
                            echo "Python install√© dans: $HOME/python"
                            $HOME/python/bin/python3.9 --version
                        fi
                    '''
                }
            }
        }
    }
}