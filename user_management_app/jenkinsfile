pipeline {
    agent any

    stages {
        stage('Installation de .NET SDK') {
            steps {
                sh '''
                    # Installation manuelle de .NET SDK sans apt-get
                    echo "Installation de .NET SDK 8.0..."
                    
                    # Vérifier si curl est disponible, sinon utiliser wget
                    if command -v curl >/dev/null 2>&1; then
                        curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh
                    else
                        wget -q https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh
                    fi
                    
                    chmod +x dotnet-install.sh
                    ./dotnet-install.sh --channel 8.0 --install-dir ${HOME}/.dotnet
                    rm dotnet-install.sh
                    
                    # Vérifier l'installation
                    echo "Version de .NET installée:"
                    ${HOME}/.dotnet/dotnet --version
                '''
            }
        }

        stage('Build') {
            steps {
                sh '''
                    # Utiliser le chemin complet pour éviter les problèmes de PATH
                    echo "Version de .NET:"
                '''
            }
        }
        
        stage('Test') {
            steps {
                sh '''
                    echo "Exécution des tests..."
                '''
            }
        }
    }

    post {
        always {
            echo "Nettoyage terminé"
        }
        success {
            echo "Build réussi!"
        }
        failure {
            echo "Build échoué!"
        }
    }
}