pipeline {
    agent any

    stages {
        stage('Installation de .NET SDK') {
            steps {
                sh '''
                    # Installation de .NET SDK 8.0 sur Debian 12
                    apt-get update
                    apt-get install -y wget apt-transport-https
                    
                    # Télécharger et installer le package Microsoft
                    wget https://packages.microsoft.com/config/debian/12/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
                    dpkg -i packages-microsoft-prod.deb
                    rm packages-microsoft-prod.deb
                    
                    # Installer le SDK .NET
                    apt-get update
                    apt-get install -y dotnet-sdk-8.0
                    
                    # Vérifier l'installation
                    echo "Version de .NET installée:"
                    dotnet --version
                '''
            }
        }

        stage('Build') {
            steps {
                sh '''
                    echo "Construction du projet..."
                    dotnet build --configuration Release
                '''
            }
        }
        
        stage('Test') {
            steps {
                sh '''
                    echo "Exécution des tests..."
                    dotnet test
                '''
            }
        }
    }

    post {
        always {
            echo "Nettoyage terminé"
        }
        success {
            echo "Build réussi!"
        }
        failure {
            echo "Build échoué!"
        }
    }
}