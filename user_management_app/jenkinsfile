pipeline {
    agent any
    
    stages {
        stage('Use Existing Python') {
            steps {
                sh '''
                    # Aller dans le répertoire de Python compilé
                    cd Python-3.9.18
                    
                    # Configurer et installer (si pas déjà fait)
                    ./configure --prefix=/usr/local/python3.9
                    make
                    make install
                    
                    # Créer des liens symboliques
                    ln -sf /usr/local/python3.9/bin/python3.9 /usr/local/bin/python3
                    ln -sf /usr/local/python3.9/bin/pip3.9 /usr/local/bin/pip3
                    
                    # Vérifier l'installation
                    /usr/local/python3.9/bin/python3.9 --version
                    /usr/local/python3.9/bin/pip3.9 --version
                '''
            }
        }
        
        stage('Set up Environment') {
            steps {
                sh '''
                    # Ajouter au PATH
                    echo 'export PATH="/usr/local/python3.9/bin:$PATH"' >> ~/.bashrc
                    source ~/.bashrc
                    
                    # Vérifier que python3 et pip3 pointent vers la bonne version
                    which python3
                    which pip3
                    python3 --version
                    pip3 --version
                '''
            }
        }
    }
}