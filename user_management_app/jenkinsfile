pipeline {
    agent any
    
    environment {
        DOTNET_ROOT = "${WORKSPACE}/dotnet"
        PATH = "${env.DOTNET_ROOT}:${env.PATH}"
    }
    
    stages {
        stage('Installation .NET') {
            steps {
                script {
                    sh '''
                        # Télécharger le script d'installation
                        curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh
                        chmod +x dotnet-install.sh
                        
                        # Installer .NET localement dans le workspace
                        ./dotnet-install.sh --channel 8.0 --install-dir ./dotnet
                        
                        # Vérifier l'installation
                        ./dotnet/dotnet --version
                        ./dotnet/dotnet --info
                    '''
                }
            }
        }
        
        stage('Build') {
            steps {
                sh 'dotnet build'
            }
        }
    }
}