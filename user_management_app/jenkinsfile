pipeline {
    agent any
    
    stages {
        stage('Installation de Python 3.9') {
            steps {
                script {
                    echo "ðŸ Installation de Python 3.9 depuis les sources..."
                    
                    sh '''
                        # Ã‰tape 1: VÃ©rifier si Python est dÃ©jÃ  installÃ©
                        if command -v python3.9 >/dev/null 2>&1; then
                            echo "âœ… Python 3.9 est dÃ©jÃ  installÃ©"
                            python3.9 --version
                            exit 0
                        fi
                        
                        # Ã‰tape 2: CrÃ©er un rÃ©pertoire d'installation
                        PYTHON_DIR="$HOME/python-3.9"
                        mkdir -p $PYTHON_DIR
                        cd $PYTHON_DIR
                        
                        # Ã‰tape 3: TÃ©lÃ©charger Python 3.9
                        echo "ðŸ“¦ TÃ©lÃ©chargement de Python 3.9..."
                        wget https://www.python.org/ftp/python/3.9.18/Python-3.9.18.tgz
                        
                        # Ã‰tape 4: Extraire
                        tar -xzf Python-3.9.18.tgz
                        cd Python-3.9.18
                        
                        # Ã‰tape 5: Configurer pour installation locale
                        echo "âš™ï¸ Configuration de l'installation..."
                        ./configure --prefix=$PYTHON_DIR --enable-optimizations
                        
                        # Ã‰tape 6: Compiler (cela peut prendre du temps)
                        echo "ðŸ”¨ Compilation en cours..."
                        make -j $(nproc)
                        
                        # Ã‰tape 7: Installer localement
                        echo "ðŸ“¦ Installation..."
                        make install
                        
                        # Ã‰tape 8: Ajouter au PATH
                        export PATH="$PYTHON_DIR/bin:$PATH"
                        echo 'export PATH="$HOME/python-3.9/bin:$PATH"' >> ~/.bashrc
                        echo 'export PATH="$HOME/python-3.9/bin:$PATH"' >> ~/.profile
                        
                        # Ã‰tape 9: VÃ©rification
                        echo "âœ… VÃ©rification..."
                        $PYTHON_DIR/bin/python3.9 --version
                        
                        echo "ðŸŽ‰ Python 3.9 installÃ© avec succÃ¨s dans: $PYTHON_DIR"
                    '''
                }
            }
        }
        
        stage('Configuration du PATH') {
            steps {
                sh '''
                    # Configurer le PATH pour cette session
                    export PATH="$HOME/python-3.9/bin:$PATH"
                    
                    echo "=== VÃ‰RIFICATION ==="
                    echo "Python: $(python3.9 --version)"
                    echo "Pip: $(python3.9 -m pip --version)"
                    echo "Emplacement: $(which python3.9)"
                '''
            }
        }
    }
}