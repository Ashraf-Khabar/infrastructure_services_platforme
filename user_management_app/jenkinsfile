pipeline {
    agent any
    
    environment {
        DOTNET_ROOT = '/usr/share/dotnet'
        PATH = "${env.DOTNET_ROOT}:${env.PATH}"
    }
    
    stages {
        stage('Installation .NET') {
            steps {
                script {
                    sh '''
                        # Créer le répertoire d'installation
                        sudo mkdir -p /usr/share/dotnet
                        sudo chmod 755 /usr/share/dotnet
                        
                        # Télécharger le script d'installation .NET
                        curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh
                        chmod +x dotnet-install.sh
                        
                        # Installer .NET SDK 8.0
                        ./dotnet-install.sh --channel 8.0 --install-dir /usr/share/dotnet
                        
                        # Installer libicu-dev (nécessaire pour .NET)
                        sudo apt-get update && sudo apt-get install -y libicu-dev || echo "Installation ICU optionnelle"
                        
                        # Vérifier l'installation
                        /usr/share/dotnet/dotnet --version
                    '''
                }
            }
        }
        
        stage('Build') {
            steps {
                sh '/usr/share/dotnet/dotnet build'
            }
        }
    }
}