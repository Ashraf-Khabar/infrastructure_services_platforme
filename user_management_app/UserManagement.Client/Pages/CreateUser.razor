@page "/create"
@using MudBlazor
@using UserManagement.Client.Models
@using UserManagement.Client.Services
@inject IUserService UserService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudGrid>
    <MudItem xs="12">
        <MudText Typo="Typo.h4" Class="mb-4">Nouvel Utilisateur</MudText>
    </MudItem>
</MudGrid>

<MudPaper Class="pa-4 mt-4" Elevation="3">
    <MudForm Model="@user">
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="user.FirstName" Label="Prénom" Required="true" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="user.LastName" Label="Nom" Required="true" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="user.Email" Label="Email" Required="true" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField @bind-Value="user.PhoneNumber" Label="Téléphone" />
            </MudItem>
            <MudItem xs="12">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" 
                          OnClick="HandleCreateUser" StartIcon="@Icons.Material.Filled.Save">
                    Créer l'utilisateur
                </MudButton>
                <MudButton Variant="Variant.Text" Color="Color.Secondary" Class="ml-2"
                          OnClick="HandleCancel">
                    Annuler
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudForm>
</MudPaper>

@code {
    private User user = new User();

    private async Task HandleCreateUser()
    {
        try
        {
            await UserService.CreateUserAsync(user);
            Snackbar.Add("Utilisateur créé avec succès", Severity.Success);
            Navigation.NavigateTo("/users");
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Erreur: {ex.Message}", Severity.Error);
        }
    }

    private void HandleCancel()
    {
        Navigation.NavigateTo("/users");
    }
}